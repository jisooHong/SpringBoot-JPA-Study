##영속성 컨텍스트와 1차 캐시

이 테스트는 통과할까?
```
public void testMember() throws  Exception{
        //given
        Member member = new Member();
        member.setUsername("memberA");

        //when
        Long saveId = memberRepository.save(member);
        Member findMember = memberRepository.find(saveId);

        //then
        Assertions.assertThat(findMember).isEqualTo(member); // True 일까 False일까?
       
}
```

이 때 테스트는 통과한다. 이유는 영속성컨텍스트와 1차 캐시 때문이다.

영속성 컨텍스트는 1차 캐시를 가지고 있다.

###1차 캐시: 
###(id, instance)의 맵 형태로 저장되는 트랜잭션 단위의 짧은 메모리 공간이다. -> 트랜잭션이 끝나면 소멸된다.
![image](https://user-images.githubusercontent.com/46811084/143200845-f277aaed-0c14-4200-a962-b933a8471845.png)

###<순서>
###1. em.persist(member)을 할 경우 1차 캐시에 인스턴스가 담긴다.
###2. 한 트랜잭션 내에서 조회를 할 경우 바로 DB에서 이를 찾지 않고 1차 캐시에서 값을 찾는다.
    = 동일성 보장이 되는 이유
###3. 만약 1차 캐시에 값이 없다면 DB를 뒤져 1차 캐시로 이동을 시켜놓은 후 반환해준다. 
