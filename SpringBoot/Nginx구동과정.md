엔진엑스의 **리버스 프록시**란?

→ 엔진엑스가 외부의 요청을 받아 백엔드 서버로 요청을 전달하는 행위

실제 요청에 대한 처리는 웹 애플리케이션 서버들이 한다.

![image](https://user-images.githubusercontent.com/46811084/163573992-7157ded7-aa90-4d74-a579-117530183d67.png)

엔진엑스는 80(http)포트, 443(https)포트를 할당한다.

스프링부트1 은 8081 포트로 실행되고, 스프링부트2는 8082 포트로 실행한다.

1. 사용자는 서비스 주소로 접속한다.(80 혹은 443포트)
2. 엔진엑스는 사용자의 요청을 받아 현재 연결된 스프링부트1로 요청을 전달한다. (첫번째는 8081 포트로 연결)
3. 스프링부트2 는 연결되어있지 않은 상태니 요청을 전달받지 못한다.

![image](https://user-images.githubusercontent.com/46811084/163573965-84a65896-09cf-480d-b7db-09d6c66e2dc0.png)

4.  1.1 버전으로 신규 배포가 필요하면, 엔진엑스와 연결되지 않은 스프링부트2(8082포트)로 배포한다. 배포하는 동안 서비스는 중단되지 않는다. 왜냐면 현재 엔진엑스는 8081포트를 바라보고 있기 때문이다. 
5. 8082포트가 정상 구동하는지 확인 후 Nginx Reload 명령어를 통해서 8081대신 8082를 바라보게 한다. reload명령은 0.1초 내에 완료된다.
6. 새 버전을 배포할 때 마다 위 과정 반복
